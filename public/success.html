<!DOCTYPE html>
<html lang="zh-TW">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>LIFF ç™»å…¥æˆåŠŸ</title>
	<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
	<style>
		body {
			font-family: Arial, sans-serif;
			text-align: center;
			padding: 20px;
		}

		img {
			border-radius: 50%;
			width: 100px;
			height: 100px;
		}
	</style>
</head>

<body>
	<h1>ğŸ‰ ç™»å…¥æˆåŠŸï¼</h1>
	<p>ä»¥ä¸‹æ˜¯æ‚¨çš„ LINE è³‡è¨Šï¼š</p>
	<img id="profilePicture" alt="Profile Picture">
	<p><strong>åç¨±ï¼š</strong> <span id="displayName">è¼‰å…¥ä¸­...</span></p>
	<p><strong>User IDï¼š</strong> <span id="userId">è¼‰å…¥ä¸­...</span></p>
	<p><strong>ç‹€æ…‹æ¶ˆæ¯ï¼š</strong> <span id="statusMessage">è¼‰å…¥ä¸­...</span></p>
	<button onclick="sendUserDataToGoogleSheet()">å„²å­˜åˆ° Google Sheets</button>
	<button onclick="closeLiff()">é—œé–‰ LIFF</button>

	<script>
		document.addEventListener('DOMContentLoaded', async () => {
			try {
				// åˆå§‹åŒ– LIFF ä¸¦ç¢ºèªå·²ç™»å…¥
				await liff.init({ liffId: '2006752354-q3wE124r' });

				if (!liff.isLoggedIn()) {
					alert('å°šæœªç™»å…¥ï¼Œå°‡è‡ªå‹•å°å‘ç™»å…¥é é¢');
					liff.login();
					return;
				}

				// å–å¾—ä½¿ç”¨è€…è³‡è¨Š
				const profile = await liff.getProfile();
				document.getElementById('displayName').textContent = profile.displayName;
				document.getElementById('userId').textContent = profile.userId;
				document.getElementById('statusMessage').textContent = profile.statusMessage || 'ç„¡';
				document.getElementById('profilePicture').src = profile.pictureUrl;

				console.log('LIFF ç™»å…¥æˆåŠŸï¼Œä½¿ç”¨è€…è³‡è¨Šï¼š', profile);


			} catch (error) {
				console.error('LIFF åˆå§‹åŒ–å¤±æ•—:', error);
				alert('LIFF åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥è¨­å®šã€‚');
			}
		});

		// è®“ä½¿ç”¨è€…é—œé–‰ LIFF è¦–çª—
		function closeLiff() {
			liff.closeWindow();
		}

		async function sendUserDataToGoogleSheet() {
			try {
				const profile = await liff.getProfile();

				const response = await fetch('https://script.google.com/a/macros/richitech.com.tw/s/AKfycbzLpFWPuybW_SyM65rcsOkVQbi9erEylxZ03MFh-BnocY1nCWjmeRRnSuWm5uD6m7Q/exec', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({
						ID: "01",
						USER_ID: profile.USER_ID,
						NAME: profile.NAME,
						COUNTY: profile.COUNTY,
						TIMESTAMP: new Date().toISOString()
					})
				});

				if (response.ok) {
					alert('ä½¿ç”¨è€…è³‡æ–™å·²æˆåŠŸå„²å­˜åˆ° Google Sheetsï¼');
				} else {
					alert('å„²å­˜å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Apps Script éƒ¨ç½²ã€‚');
				}
			} catch (error) {
				console.error('å‚³é€å¤±æ•—ï¼š', error);
				alert('å„²å­˜å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Apps Script éƒ¨ç½²ã€‚');
			}
		}

	</script>
</body>

</html>
